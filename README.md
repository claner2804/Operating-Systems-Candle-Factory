Aufgabe \
Es soll ein Programm implementiert werden, welches eine Fabrik simuliert. In dieser Fabrik stellen Arbeiter:innen Produkte aus verschiedenen Ausgangsstoffen her. Die Ausgangsstoffe und die Endprodukte werden in einem großen Lager gelagert, welches aber aufgrund räumlicher Gegebenheiten nur von einem:einer Arbeiter:in gleichzeitig betreten werden kann (und somit eine kritische Region darstellt).
Konkret werden in der Fabrik Kerzen hergestellt, welche aus den zwei Ausgangsstoffen Wachs und Docht bestehen. Die Arbeiter:innen holen sich zuerst drei Einheiten Wachs und einen Docht aus dem Lager, gehen damit an ihren Arbeitsplatz und stellen eine Kerze her, welche sie anschließend wieder in das Lager bringen.
Da das Lager nur eine begrenzte Kapazität besitzt, gehen mit der Zeit Wachs und Dochte zu Neige. Deshalb wird in regelmäßigen Abständen Wachs und Docht im Lager nachgefüllt. Wenn kein Wachs oder Docht mehr im Lager zu finden ist, können die Arbeiter:innen, die auf diese Ressourcen warten, ein Nickerchen machen, müssen aber nach Füllung des Lager wieder aufgeweckt werden.
Auch das Kerzenlager kann mit der Zeit so voll werden, dass keine neuen Kerzen mehr hineinpassen. Aus diesem Grund wird das Kerzenlager in regelmäßigen Abständen geleert. In der Zwischenzeit gehen alle Arbeiter:innen, die auf einen freien Platz im Lager warten um dort ihre produzierten Kerzen unterzubringen, auf einen Kaffee in die Kaffeeküche. Sobald ein freier Platz im Lager verfügbar ist, müssen Sie dann davon in Kenntnis gesetzt werden.
Repräsentieren Sie in Ihrem Programm die Arbeiter:innen durch Threads, insgesamt gibt es 6 Arbeiter:innen. Das Lager repräsentieren Sie durch eine struct, in der die Lagerstände für Wachs, Dochte und Kerzen durch jeweils eine positive Ganzzahl repräsentiert werden.
Verwenden Sie Mutexe, um die kritische Region des Lagers zu schützen und Condition Variablen, um die Arbeiter:innen ein Nickerchen machen bzw. Kaffe trinken zu lassen und dann wieder aufzuwecken bzw. zu informieren, dass wieder Platz im Lager ist.
Simulieren Sie die für die Herstellung einer Kerze benötigte Zeit durch sleep().
Verwenden Sie alarm(), um die in regelmäßigen Abständen das Lager zu füllen bzw. zu leeren. Das Lager für Wachs soll dabei alle 10 Sekunden gefüllt werden, das Lager für die Dochte alle 15 Sekunden und das Lager für die Kerzen alle 20 Sekunden geleert werden. Wählen Sie für die maximalen Lagerstände passende Werte so aus, dass auch regelmäßig der Fall eintritt, dass Wachs und Dochte ausgehen bzw. das Kerzenlager voll ist.
Um die Fabrik sauber schließen zu können, soll ein gracefull Shutdown implementiert werden, der die Threads, welche die Arbeiter:innen repräsentieren, sauber beendet.
Um die Lösung der Aufgabe zu erleichtern, haben wir im folgenden den Lösungsweg in viele einfach zu erledigende Einzelschritte unterteilt:
Definieren und deklarieren Sie eine struct, die das Lager repräsentiert und auf die alle Threads Zugriff haben.
Schreiben Sie eine Funktion createCandle(), die wiederholt in einer Schleife die Ausgangsprodukte aus dem Lager holt, eine Kerze herstellt (lassen Sie den Thread dabei eine Sekunde schlafen) und diese anschließend in das Lager bringt.
Schreiben Sie eine Funktion manageStorage(), die in regelmäßigen Abständen ausgeführt wird und das Füllen der Lagerstände bzw. Leeren des Kerzenlagers in den angegeben Zeiten erledigt (Tipp: Sie können diese Funktion einfach alle 5 Sekunden ausführen und mithilfe eines Zählers feststellen, welche Aktion gerade fällig ist).
Sorgen Sie dafür, dass in den Funktionen createCandle(), manageStorage() die kritische Region des Lagers mit einer Mutex entspechend geschützt ist, und dass mit Condition Variablen die Arbeiter:innen bei einem leeren bzw. vollen Lager schlafengelegt und wieder aufgeweckt werden können.
Erzeugen Sie die Threads, die die Arbeiter:innen repräsentieren und die Funktion createCandle() ausführen.
Führen Sie die Funktion manageStorage() in regelmäßigen Abständen mithilfe von alarm() aus.
Schreiben Sie einen Signal-Handler, der dafür sorgt, dass sich beim Druck von STR+C das Programm beendet. Dabei sollen auch alle Threads sauber beendet werden und vergessen Sie nicht, alle Resourcen wieder freizugeben.
Sorgen Sie bei allen Systemaufrufen für eine entsprechende Fehlerbehandlung und geben Sie im Bedarfsfall eine Fehlermeldung auf stderr aus.
